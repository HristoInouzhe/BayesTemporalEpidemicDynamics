<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BayesTemporalEpidemicDynamics — Galleries</title>
  <style>
    :root{
      --gap:14px;--tile-radius:14px;--max-width:1400px;--shadow:0 6px 22px rgba(0,0,0,.08)
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial,"Apple Color Emoji","Segoe UI Emoji";background:#0b0c10;color:#e9eef3}
    header{max-width:var(--max-width);margin:24px auto 10px;padding:0 16px}
    h1{font-size:clamp(22px,3.5vw,34px);margin:0 0 10px;font-weight:700}
    .sub{opacity:.8;margin-bottom:16px;font-size:15px}
    .controls{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    input[type="search"]{flex:1;min-width:220px;padding:12px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:#11141a;color:#e9eef3;outline:none}
    .tabs{display:flex;gap:8px;flex-wrap:wrap}
    .tab{border:1px solid rgba(255,255,255,.14);background:#11141a;color:#e9eef3;padding:8px 12px;border-radius:10px;cursor:pointer;opacity:.9}
    .tab.active{background:#1b202a;border-color:rgba(255,255,255,.28)}

    main{max-width:var(--max-width);margin:10px auto 48px;padding:0 16px}

    .grid{display:grid;gap:var(--gap)}
    /* responsive fallbacks for tiles when space is tight */
    .grid-auto{grid-template-columns:repeat(auto-fill,minmax(160px,1fr))}
    .grid-3x3{grid-template-columns:repeat(3,minmax(0,1fr))}
    .grid-3x2{grid-template-columns:repeat(3,minmax(0,1fr))}
    .grid-2x2{grid-template-columns:repeat(2,minmax(0,1fr))}

    .section{margin-top:22px}
    .section h2{margin:22px 0 12px;font-size:22px}

    .tile{position:relative;display:block;text-decoration:none;color:inherit;background:#11141a;border:1px solid rgba(255,255,255,.08);border-radius:var(--tile-radius);overflow:hidden;box-shadow:var(--shadow);transition:transform .15s ease-in-out}
    .tile:hover{transform:scale(1.04)}
    .tile .thumb{width:100%;aspect-ratio:1.4/1;object-fit:contain;background:#0e1117}
    .tile .meta{padding:8px 10px;display:flex;align-items:center;gap:8px;justify-content:space-between}
    .caption{font-size:12px;line-height:1.3;opacity:.95}
    .badge{font-size:10px;padding:3px 6px;border-radius:999px;border:1px solid rgba(255,255,255,.16);opacity:.9}
    .hide{display:none!important}

    footer{max-width:var(--max-width);margin:0 auto 60px;padding:0 16px;opacity:.7;font-size:12px}
    /* optional slightly smaller tiles only in densities */
    #sec-dens .tile .thumb{aspect-ratio:1.4/1;object-fit:contain}
    #sec-dens .caption{font-size:11px}

    .legend-wrap{max-width:1400px;margin:20px auto;padding:0 16px}
    .legend-img{width:65%;height:auto;display:block;margin:0 auto;border:1px solid rgba(255,255,255,.2);border-radius:10px}
  </style>
</head>
<body>
<header>
  <h1>BayesTemporalEpidemicDynamics — Interactive Galleries</h1>
  <div class="sub">Switch gallery below. Click any PDF to open in a new tab. Use the search box to filter.</div>
  <div class="controls">
    <div class="tabs" id="tabs"></div>
    <input id="search" type="search" placeholder="Filter (e.g., 'SEI3R', 'beta', 'R₀', 'density alpha', 'Set 01')…" />
    <div class="muted">Total: <span id="count">0</span></div>
  </div>
</header>

<main id="gallery-root">
  <!-- legends (top + densities) populated per gallery if files exist) -->
  <div class="legend-wrap" id="legend-top"></div>

  <section id="sec-r0" class="section">
    <h2>Basic Reproduction Number</h2>
    <div class="grid" id="grid-r0"></div>
  </section>

  <section id="sec-beta" class="section">
    <h2>Transmission Rate</h2>
    <div class="grid" id="grid-beta"></div>
  </section>

  <section id="sec-pp" class="section">
    <h2>Posterior Predictive Daily Incidence</h2>
    <div class="grid" id="grid-pp"></div>
  </section>

  <div class="legend-wrap" id="legend-dens"></div>

  <section id="sec-dens" class="section">
    <h2>Posterior Parameter Densities</h2>
    <div id="dens-sets"></div>
  </section>
</main>

<footer>
  <div>Tip: Use URL hash to open directly a gallery, e.g. <code>#sensitivity</code>, <code>#synthetic</code>, or <code>#basque</code>.</div>
</footer>

<script>
/**
 * MULTI-GALLERY CONFIG
 * - Keeps existing Sensitivity gallery (by Set 01..N)
 * - Adds Synthetic Data and Basque Country COVID galleries (by Model: SEI3R, SEIR, SI3R, SIR)
 * - For new galleries, the R0/Beta/PP grids use 2×2 layout as requested
 * - Densities keep the 3×2 per group (Set or Model)
 *
 * File naming (recommended):
 *   Sensitivity (already present): testSens_<SET>_<kind>.pdf
 *   Synthetic:   synthetic_<MODEL>_<kind>.pdf
 *   Basque:      basque_<MODEL>_<kind>.pdf
 * where <kind> ∈ { beta, R0, posteriorpredictive, density_alpha, density_E0, density_I0, density_phi_inv, density_S0, density_tau, ... }
 */

const GALLERIES = [
  {
    id: 'sensitivity',
    label: 'Sensitivity study',
    title: 'Sensitivity Study — Interactive Gallery',
    legends: {
      top: 'images/thumbs/legend_transmission_sensitivity_thumb.jpg',
      dens: 'images/thumbs/legend_param_densities_sensitivity_thumb.jpg'
    },
    // Explicit file list as before (keep editing here to add/remove sets)
    files: [
      // === COPY of your current list (unchanged) ===
      "testSens_01_beta.pdf","testSens_01_density_alpha.pdf","testSens_01_density_E0.pdf",
      "testSens_01_density_I0.pdf","testSens_01_density_phi_inv.pdf","testSens_01_density_S0.pdf",
      "testSens_01_density_tau.pdf","testSens_01_posteriorpredictive.pdf","testSens_01_R0.pdf",
      "testSens_02_beta.pdf","testSens_02_density_alpha.pdf","testSens_02_density_E0.pdf",
      "testSens_02_density_I0.pdf","testSens_02_density_phi_inv.pdf","testSens_02_density_S0.pdf",
      "testSens_02_density_tau.pdf","testSens_02_posteriorpredictive.pdf","testSens_02_R0.pdf",
      "testSens_03_beta.pdf","testSens_03_density_alpha.pdf","testSens_03_density_E0.pdf",
      "testSens_03_density_I0.pdf","testSens_03_density_phi_inv.pdf","testSens_03_density_S0.pdf",
      "testSens_03_density_tau.pdf","testSens_03_posteriorpredictive.pdf","testSens_03_R0.pdf",
      "testSens_04_beta.pdf","testSens_04_density_alpha.pdf","testSens_04_density_E0.pdf",
      "testSens_04_density_I0.pdf","testSens_04_density_phi_inv.pdf","testSens_04_density_S0.pdf",
      "testSens_04_density_tau.pdf","testSens_04_posteriorpredictive.pdf","testSens_04_R0.pdf",
      "testSens_05_beta.pdf","testSens_05_density_alpha.pdf","testSens_05_density_E0.pdf",
      "testSens_05_density_I0.pdf","testSens_05_density_phi_inv.pdf","testSens_05_density_S0.pdf",
      "testSens_05_density_tau.pdf","testSens_05_posteriorpredictive.pdf","testSens_05_R0.pdf",
      "testSens_06_beta.pdf","testSens_06_density_alpha.pdf","testSens_06_density_E0.pdf",
      "testSens_06_density_I0.pdf","testSens_06_density_phi_inv.pdf","testSens_06_density_S0.pdf",
      "testSens_06_density_tau.pdf","testSens_06_posteriorpredictive.pdf","testSens_06_R0.pdf",
      "testSens_07_beta.pdf","testSens_07_density_alpha.pdf","testSens_07_density_E0.pdf",
      "testSens_07_density_I0.pdf","testSens_07_density_phi_inv.pdf","testSens_07_density_S0.pdf",
      "testSens_07_density_tau.pdf","testSens_07_posteriorpredictive.pdf","testSens_07_R0.pdf",
      "testSens_08_beta.pdf","testSens_08_density_alpha.pdf","testSens_08_density_E0.pdf",
      "testSens_08_density_I0.pdf","testSens_08_density_phi_inv.pdf","testSens_08_density_S0.pdf",
      "testSens_08_density_tau.pdf","testSens_08_posteriorpredictive.pdf","testSens_08_R0.pdf",
      "testSens_09_beta.pdf","testSens_09_density_alpha.pdf","testSens_09_density_E0.pdf",
      "testSens_09_density_I0.pdf","testSens_09_density_phi_inv.pdf","testSens_09_density_S0.pdf",
      "testSens_09_density_tau.pdf","testSens_09_posteriorpredictive.pdf","testSens_09_R0.pdf"
    ],
    grouping: 'set',        // UI label prefix ("Set 01")
    gridClassMetrics: 'grid-3x3' // keep current 3×3 layout for metrics
  },
  {
    id: 'synthetic',
    label: 'Synthetic data',
    title: 'Synthetic Data — Interactive Gallery',
    legends: { top: 'images/thumbs/legend_transmission_sensitivity_thumb.jpg', dens: 'images/thumbs/legend_param_densities_sensitivity_thumb.jpg' },
    // You only need to place the files under /images with these names
    // e.g. images/synthetic_SEI3R_R0.pdf, images/synthetic_SIR_posteriorpredictive.pdf, etc.
    files: [
      // Minimal placeholders for structure (add your real files to repo)
      "synthetic_sei3r_beta.pdf","synthetic_sei3r_density_alpha.pdf","synthetic_sei3r_density_E0.pdf",
      "synthetic_sei3r_density_I0.pdf","synthetic_sei3r_density_phi_inv.pdf","synthetic_sei3r_density_S0.pdf",
      "synthetic_sei3r_density_tau.pdf","synthetic_sei3r_posteriorpredictive.pdf","synthetic_sei3r_R0.pdf",
      "synthetic_seir_beta.pdf","synthetic_seir_density_alpha.pdf","synthetic_seir_density_E0.pdf",
      "synthetic_seir_density_I0.pdf","synthetic_seir_density_phi_inv.pdf","synthetic_seir_density_S0.pdf",
      "synthetic_seir_density_tau.pdf","synthetic_seir_posteriorpredictive.pdf","synthetic_seir_R0.pdf",
      "synthetic_si3r_beta.pdf","synthetic_si3r_density_alpha.pdf", "synthetic_si3r_density_I0.pdf",
      "synthetic_si3r_density_phi_inv.pdf","synthetic_si3r_density_S0.pdf",
      "synthetic_si3r_density_tau.pdf","synthetic_si3r_posteriorpredictive.pdf","synthetic_si3r_R0.pdf",
      "synthetic_sir_beta.pdf","synthetic_sir_density_alpha.pdf", "synthetic_sir_density_I0.pdf",
      "synthetic_sir_density_phi_inv.pdf","synthetic_sir_density_S0.pdf",
      "synthetic_sir_density_tau.pdf","synthetic_sir_posteriorpredictive.pdf","synthetic_sir_R0.pdf"
    ],
    grouping: 'model',      // UI label prefix ("Model SEI3R")
    gridClassMetrics: 'grid-2x2' // 2×2 as requested
  },
  {
    id: 'basque',
    label: 'Basque Country COVID',
    title: 'Basque Country COVID — Interactive Gallery',
    legends: { top: 'images/thumbs/legend_transmission_sensitivity_thumb.jpg', dens: 'images/thumbs/legend_param_densities_sensitivity_thumb.jpg' },
    files: [
      "basque_sei3r_beta.pdf","basque_sei3r_density_alpha.pdf","basque_sei3r_density_E0.pdf",
      "basque_sei3r_density_I0.pdf","basque_sei3r_density_phi_inv.pdf","basque_sei3r_density_S0.pdf",
      "basque_sei3r_density_tau.pdf","basque_sei3r_posteriorpredictive.pdf","basque_sei3r_R0.pdf",
      "basque_seir_beta.pdf","basque_seir_density_alpha.pdf","basque_seir_density_E0.pdf",
      "basque_seir_density_I0.pdf","basque_seir_density_phi_inv.pdf","basque_seir_density_S0.pdf",
      "basque_seir_density_tau.pdf","basque_seir_posteriorpredictive.pdf","basque_seir_R0.pdf",
      "basque_si3r_beta.pdf","basque_si3r_density_alpha.pdf", "basque_si3r_density_I0.pdf",
      "basque_si3r_density_phi_inv.pdf","basque_si3r_density_S0.pdf",
      "basque_si3r_density_tau.pdf","basque_si3r_posteriorpredictive.pdf","basque_si3r_R0.pdf",
      "basque_sir_beta.pdf","basque_sir_density_alpha.pdf", "basque_sir_density_I0.pdf",
      "basque_sir_density_phi_inv.pdf","basque_sir_density_S0.pdf",
      "basque_sir_density_tau.pdf","basque_sir_posteriorpredictive.pdf","basque_sir_R0.pdf"
    ],
    grouping: 'model',
    gridClassMetrics: 'grid-2x2'
  }
];

// ====== Helpers ======
const IMG_DIR   = 'images';
const THUMB_DIR = 'images/thumbs';

function thumbCandidates(fname){
  const base=fname.replace(/\.pdf$/i,'');
  return [`${THUMB_DIR}/${base}_thumb.jpg`, `${THUMB_DIR}/${base}.jpg`];
}

function buildCaptionSensitivity(name){
  const base=name.replace(/\.pdf$/i,'');
  const m=base.match(/^testSens_(\d+)_([\s\S]+)$/i);
  const set=m?m[1]:''; let rest=m?m[2]:base;
  rest=rest.replace(/posteriorpredictive/i,'posterior predictive').replace(/phi_inv/i,'phi⁻¹').replace(/R0/g,'R₀').replace(/_/g,' ');
  return `Set ${set} — ${rest}`;
}

function buildCaptionModel(name, prefix){
  const base=name.replace(/\.pdf$/i,'');
  const re=new RegExp(`^${prefix}_(SEI3R|SEIR|SI3R|SIR)_([\\s\\S]+)$`,`i`);
  const m=base.match(re);
  const model=m?m[1]:''; let rest=m?m[2]:base;
  rest=rest.replace(/posteriorpredictive/i,'posterior predictive').replace(/phi_inv/i,'phi⁻¹').replace(/R0/g,'R₀').replace(/_/g,' ');
  return `Model ${model} — ${rest}`;
}

function makePdfTile(fname, caption){
  const a=document.createElement('a');
  a.className='tile'; a.dataset.type='pdf'; a.dataset.caption=caption; a.href=`${IMG_DIR}/${fname}`; a.target='_blank'; a.rel='noopener';
  const img=document.createElement('img'); img.className='thumb'; img.loading='lazy';
  const cands=thumbCandidates(fname); img.src=cands[0]; img.alt=`${caption} (PDF)`; img.onerror=function(){ if(img.dataset.fallbackTried)return; img.dataset.fallbackTried='1'; img.src=cands[1]; };
  const meta=document.createElement('div'); meta.className='meta';
  const cap=document.createElement('div'); cap.className='caption'; cap.textContent=`${caption} (PDF)`;
  const badge=document.createElement('div'); badge.className='badge'; badge.textContent='pdf';
  meta.appendChild(cap); meta.appendChild(badge); a.appendChild(img); a.appendChild(meta); return a;
}

function groupSensitivity(files){
  const groups={};
  files.forEach(f=>{const m=f.match(/^testSens_(\d+)_([\s\S]+)\.pdf$/i); if(!m)return; const set=m[1]; const kind=m[2];
    groups[set]??={beta:null,r0:null,pp:null,densities:[]};
    if(/^beta$/i.test(kind)) groups[set].beta=f; else if(/^R0$/i.test(kind)) groups[set].r0=f; else if(/^posteriorpredictive$/i.test(kind)) groups[set].pp=f; else if(/^density_/i.test(kind)) groups[set].densities.push(f);
  });
  const ids=Object.keys(groups).sort((a,b)=>Number(a)-Number(b));
  return {ids, groups, caption:(fn)=>buildCaptionSensitivity(fn)};
}

function groupByModel(files, prefix){
  const groups={};
  files.forEach(f=>{const m=f.match(new RegExp(`^${prefix}_(SEI3R|SEIR|SI3R|SIR)_([\\s\\S]+)\\.pdf$`,'i')); if(!m)return; const model=m[1]; const kind=m[2];
    groups[model]??={beta:null,r0:null,pp:null,densities:[]};
    if(/^beta$/i.test(kind)) groups[model].beta=f; else if(/^R0$/i.test(kind)) groups[model].r0=f; else if(/^posteriorpredictive$/i.test(kind)) groups[model].pp=f; else if(/^density_/i.test(kind)) groups[model].densities.push(f);
  });
  const ids=Object.keys(groups).sort();
  const caption=(fn)=>buildCaptionModel(fn,prefix);
  return {ids, groups, caption};
}

// DOM refs
const tabs     = document.getElementById('tabs');
const root     = document.getElementById('gallery-root');
const gridR0   = document.getElementById('grid-r0');
const gridBeta = document.getElementById('grid-beta');
const gridPP   = document.getElementById('grid-pp');
const densRoot = document.getElementById('dens-sets');
const legendTop  = document.getElementById('legend-top');
const legendDens = document.getElementById('legend-dens');
const search  = document.getElementById('search');
const count   = document.getElementById('count');

let allTiles=[]; // for filter
let activeGalleryId=null;

function clearChildren(el){ while(el.firstChild) el.removeChild(el.firstChild); }

function setGridClasses(metricsGridClass){
  gridR0.className  = `grid ${metricsGridClass}`;
  gridBeta.className= `grid ${metricsGridClass}`;
  gridPP.className  = `grid ${metricsGridClass}`;
}

function renderLegends(legends){
  clearChildren(legendTop); clearChildren(legendDens);
  if(legends?.top){ const img=document.createElement('img'); img.src=legends.top; img.alt='Legend'; img.className='legend-img'; legendTop.appendChild(img); }
  if(legends?.dens){ const img=document.createElement('img'); img.src=legends.dens; img.alt='Legend (densities)'; img.className='legend-img'; legendDens.appendChild(img); }
}

function applyFilter(q){
  const needle=(q||'').trim().toLowerCase(); let visible=0;
  allTiles.forEach(t=>{ const hay=(t.dataset.caption+' '+(t.getAttribute('href')||'')).toLowerCase(); const show=!needle||hay.includes(needle); t.classList.toggle('hide',!show); if(show) visible++; });
  if(count) count.textContent=visible;
}

function renderGallery(g){
  activeGalleryId=g.id;
  document.title=g.title;
  // grids & legends
  setGridClasses(g.gridClassMetrics || 'grid-3x3');
  renderLegends(g.legends);
  clearChildren(gridR0); clearChildren(gridBeta); clearChildren(gridPP); clearChildren(densRoot);

  // choose grouping function
  let grouped, captionFn;
  if(g.id==='sensitivity'){
    grouped = groupSensitivity(g.files);
  } else if(g.id==='synthetic'){
    grouped = groupByModel(g.files,'synthetic');
  } else {
    grouped = groupByModel(g.files,'basque');
  }
  captionFn = grouped.caption;

  // Fill metric grids
  grouped.ids.forEach(id=>{ const f=grouped.groups[id].r0;   if(f) gridR0.appendChild( makePdfTile(f, captionFn(f)) ); });
  grouped.ids.forEach(id=>{ const f=grouped.groups[id].beta; if(f) gridBeta.appendChild( makePdfTile(f, captionFn(f)) ); });
  grouped.ids.forEach(id=>{ const f=grouped.groups[id].pp;   if(f) gridPP.appendChild( makePdfTile(f, captionFn(f)) ); });

  // Densities per group (3×2)
  grouped.ids.forEach(id=>{
    const densList=(grouped.groups[id].densities||[]).sort(); if(!densList.length) return;
    const block=document.createElement('section'); block.style.margin='18px 0 28px';
    const h=document.createElement('h3');
    h.textContent = (g.grouping==='set'?`Set ${id}`:`Model ${id}`);
    h.style.margin='12px 0'; h.style.fontSize='18px'; block.appendChild(h);
    const grid=document.createElement('div'); grid.className='grid grid-3x2';
    densList.forEach(f=> grid.appendChild( makePdfTile(f, captionFn(f)) ));
    block.appendChild(grid); densRoot.appendChild(block);
  });

  // update filter cache
  allTiles = Array.from(document.querySelectorAll('.tile'));
  applyFilter(search?.value || '');
}

function buildTabs(){
  clearChildren(tabs);
  GALLERIES.forEach(g=>{
    const b=document.createElement('button'); b.className='tab'; b.textContent=g.label; b.dataset.id=g.id;
    b.addEventListener('click',()=>{ location.hash = g.id; selectTab(g.id); renderGallery(g); });
    tabs.appendChild(b);
  });
}

function selectTab(id){
  Array.from(tabs.children).forEach(el=> el.classList.toggle('active', el.dataset.id===id));
}

// init
buildTabs();
search?.addEventListener('input', e=>applyFilter(e.target.value));

function boot(){
  const id = (location.hash || '').replace('#','') || 'sensitivity';
  const g = GALLERIES.find(x=>x.id===id) || GALLERIES[0];
  selectTab(g.id); renderGallery(g);
}
window.addEventListener('hashchange', boot);
boot();
</script>
</body>
</html>
