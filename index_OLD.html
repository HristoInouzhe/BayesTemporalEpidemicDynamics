<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sensitivity Study Gallery</title>
  <style>
    :root {
      --gap: 14px;
      --tile-radius: 14px;
      --max-width: 1400px;
      --shadow: 0 6px 22px rgba(0,0,0,.08);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background:#0b0c10;
      color:#e9eef3;
    }
    header {
      max-width: var(--max-width);
      margin: 24px auto 10px;
      padding: 0 16px;
    }
    h1 { font-size: clamp(22px, 3.5vw, 34px); margin: 0 0 10px; font-weight: 700; }
    .sub { opacity:.8; margin-bottom: 16px; font-size: 15px; }
    .controls {
      display:flex; gap:10px; align-items:center; flex-wrap:wrap;
    }
    input[type="search"]{
      flex:1; min-width: 220px;
      padding:12px 14px;
      border-radius: 12px;
      border:1px solid rgba(255,255,255,.12);
      background:#11141a;
      color:#e9eef3;
      outline:none;
    }
    .grid {
      max-width: var(--max-width);
      margin: 10px auto 48px;
      padding: 0 16px;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); /* smaller tiles */
      gap: var(--gap);
    }
    /* Fixed column grids */
    .grid-3x3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
    .grid-3x2 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
    .tile {
      position: relative; display:block; text-decoration:none; color:inherit;
      background:#11141a;
      border:1px solid rgba(255,255,255,.08);
      border-radius: var(--tile-radius);
      overflow:hidden;
      box-shadow: var(--shadow);
      transition: transform 0.15s ease-in-out;
    }
    .tile:hover { transform: scale(1.04); }
    .tile .thumb {
      width:100%;
      aspect-ratio: 1.4 / 1; /* landscape A4 */
      object-fit: contain;   /* show whole PDF */
      background: #0e1117;
    }
    .tile .meta {
      padding: 8px 10px; display:flex; align-items:center; gap:8px; justify-content:space-between;
    }
    .caption { font-size: 12px; line-height:1.3; opacity:.95; }
    .badge {
      font-size: 10px;
      padding:3px 6px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.16);
      opacity:.9;
    }
    .hide { display:none !important; }
    footer {
      max-width: var(--max-width);
      margin: 0 auto 60px;
      padding: 0 16px;
      opacity:.7;
      font-size:12px;
    }

    /* Optional: slightly smaller tiles in densities section */
    #sec-dens .tile .thumb { aspect-ratio: 1.4 / 1; object-fit: contain; }
    #sec-dens .caption { font-size: 11px; }
  </style>
</head>

<header>
  <h1>Sensitivity Study — Interactive Gallery</h1>
  <div class="sub">Click any PDF to open in a new tab. Filter by set or metric using the search box.</div>
  <div class="controls">
    <input id="search" type="search" placeholder="Filter (e.g., 'Set 01', 'beta', 'R₀', 'density alpha')…" />
    <div class="muted">Total: <span id="count">0</span></div>
  </div>
</header>

<main id="gallery-root" style="max-width:1400px;margin:10px auto 48px;padding:0 16px;">
  <!-- Legend thumbnail before R0 -->
  <div style="max-width:1400px;margin:20px auto;padding:0 16px;">
    <img src="images/thumbs/legend_transmission_sensitivity_thumb.jpg"
        alt="Legend for Basic Reproduction Number, Transmission Rate, and Posterior Predictive Daily Incidence"
        style="width:65%;height:auto;display:block;margin:0 auto;
                border:1px solid rgba(255,255,255,.2);border-radius:10px;">
  </div>

  <!-- Basic Reproduction Number (3x3) -->
  <section id="sec-r0" class="section">
    <h2 style="margin:22px 0 12px;font-size:22px;">Basic Reproduction Number</h2>
    <div class="grid grid-3x3" id="grid-r0"></div>
  </section>

  <!-- Transmission Rate (3x3) -->
  <section id="sec-beta" class="section">
    <h2 style="margin:28px 0 12px;font-size:22px;">Transmission Rate</h2>
    <div class="grid grid-3x3" id="grid-beta"></div>
  </section>

  <!-- Posterior Predictive Daily Incidence (3x3) -->
  <section id="sec-pp" class="section">
    <h2 style="margin:28px 0 12px;font-size:22px;">Posterior Predictive Daily Incidence</h2>
    <div class="grid grid-3x3" id="grid-pp"></div>
  </section>

  <!-- Legend thumbnail before R0 -->
  <div style="max-width:1400px;margin:20px auto;padding:0 16px;">
    <img src="images/thumbs/legend_param_densities_sensitivity_thumb.jpg"
        alt="Legend for Basic Reproduction Number, Transmission Rate, and Posterior Predictive Daily Incidence"
        style="width:65%;height:auto;display:block;margin:0 auto;
                border:1px solid rgba(255,255,255,.2);border-radius:10px;">
  </div>

  <!-- Posterior Parameter Densities (per-set 3x2) -->
  <section id="sec-dens" class="section">
    <h2 style="margin:28px 0 12px;font-size:22px;">Posterior Parameter Densities</h2>
    <div id="dens-sets"></div>
  </section>
</main>

<script>
// ===== Your files (exact names in /images) =====
const files = [
  "testSens_01_beta.pdf","testSens_01_density_alpha.pdf","testSens_01_density_E0.pdf",
  "testSens_01_density_I0.pdf","testSens_01_density_phi_inv.pdf","testSens_01_density_S0.pdf",
  "testSens_01_density_tau.pdf","testSens_01_posteriorpredictive.pdf","testSens_01_R0.pdf",
  "testSens_02_beta.pdf","testSens_02_density_alpha.pdf","testSens_02_density_E0.pdf",
  "testSens_02_density_I0.pdf","testSens_02_density_phi_inv.pdf","testSens_02_density_S0.pdf",
  "testSens_02_density_tau.pdf","testSens_02_posteriorpredictive.pdf","testSens_02_R0.pdf",
  "testSens_03_beta.pdf","testSens_03_density_alpha.pdf","testSens_03_density_E0.pdf",
  "testSens_03_density_I0.pdf","testSens_03_density_phi_inv.pdf","testSens_03_density_S0.pdf",
  "testSens_03_density_tau.pdf","testSens_03_posteriorpredictive.pdf","testSens_03_R0.pdf",
  "testSens_04_beta.pdf","testSens_04_density_alpha.pdf","testSens_04_density_E0.pdf",
  "testSens_04_density_I0.pdf","testSens_04_density_phi_inv.pdf","testSens_04_density_S0.pdf",
  "testSens_04_density_tau.pdf","testSens_04_posteriorpredictive.pdf","testSens_04_R0.pdf",
  "testSens_05_beta.pdf","testSens_05_density_alpha.pdf","testSens_05_density_E0.pdf",
  "testSens_05_density_I0.pdf","testSens_05_density_phi_inv.pdf","testSens_05_density_S0.pdf",
  "testSens_05_density_tau.pdf","testSens_05_posteriorpredictive.pdf","testSens_05_R0.pdf",
  "testSens_06_beta.pdf","testSens_06_density_alpha.pdf","testSens_06_density_E0.pdf",
  "testSens_06_density_I0.pdf","testSens_06_density_phi_inv.pdf","testSens_06_density_S0.pdf",
  "testSens_06_density_tau.pdf","testSens_06_posteriorpredictive.pdf","testSens_06_R0.pdf",
  "testSens_07_beta.pdf","testSens_07_density_alpha.pdf","testSens_07_density_E0.pdf",
  "testSens_07_density_I0.pdf","testSens_07_density_phi_inv.pdf","testSens_07_density_S0.pdf",
  "testSens_07_density_tau.pdf","testSens_07_posteriorpredictive.pdf","testSens_07_R0.pdf",
  "testSens_08_beta.pdf","testSens_08_density_alpha.pdf","testSens_08_density_E0.pdf",
  "testSens_08_density_I0.pdf","testSens_08_density_phi_inv.pdf","testSens_08_density_S0.pdf",
  "testSens_08_density_tau.pdf","testSens_08_posteriorpredictive.pdf","testSens_08_R0.pdf",
  "testSens_09_beta.pdf","testSens_09_density_alpha.pdf","testSens_09_density_E0.pdf",
  "testSens_09_density_I0.pdf","testSens_09_density_phi_inv.pdf","testSens_09_density_S0.pdf",
  "testSens_09_density_tau.pdf","testSens_09_posteriorpredictive.pdf","testSens_09_R0.pdf"
];

// ===== Helpers =====
const IMG_DIR = 'images';
const THUMB_DIR = 'images/thumbs';

function buildCaption(name) {
  const base = name.replace(/\.pdf$/i,'');
  const m = base.match(/^testSens_(\d+)_([\s\S]+)$/i);
  const set = m ? m[1] : '';
  let rest = m ? m[2] : base;
  rest = rest
    .replace(/posteriorpredictive/i, 'posterior predictive')
    .replace(/phi_inv/i, 'phi⁻¹')
    .replace(/R0/g, 'R₀')
    .replace(/_/g, ' ');
  return `Set ${set} — ${rest}`;
}
function thumbCandidates(fname) {
  const base = fname.replace(/\.pdf$/i,'');
  return [
    `${THUMB_DIR}/${base}_thumb.jpg`,
    `${THUMB_DIR}/${base}.jpg`
  ];
}
function makePdfTile(fname) {
  const href = `${IMG_DIR}/${fname}`;
  const caption = buildCaption(fname);

  const a = document.createElement('a');
  a.className = 'tile';
  a.dataset.type = 'pdf';
  a.dataset.caption = caption;
  a.href = href;
  a.target = '_blank';
  a.rel = 'noopener';

  const img = document.createElement('img');
  img.className = 'thumb';
  img.loading = 'lazy';
  const cands = thumbCandidates(fname);
  img.src = cands[0];
  img.alt = `${caption} (PDF)`;
  img.onerror = function(){
    if (img.dataset.fallbackTried) return;
    img.dataset.fallbackTried = '1';
    img.src = cands[1];
  };

  const meta = document.createElement('div');
  meta.className = 'meta';
  const cap = document.createElement('div');
  cap.className = 'caption';
  cap.textContent = `${caption} (PDF)`;
  const badge = document.createElement('div');
  badge.className = 'badge';
  badge.textContent = 'pdf';
  meta.appendChild(cap); meta.appendChild(badge);
  a.appendChild(img); a.appendChild(meta);
  return a;
}

// ===== Group by set and kind =====
const groups = {}; // { set: { beta:..., r0:..., pp:..., densities:[...] } }
files.forEach(f => {
  const m = f.match(/^testSens_(\d+)_([\s\S]+)\.pdf$/i);
  if (!m) return;
  const set = m[1];
  const kind = m[2];
  groups[set] ??= { beta:null, r0:null, pp:null, densities:[] };
  if (/^beta$/i.test(kind)) groups[set].beta = f;
  else if (/^R0$/i.test(kind)) groups[set].r0 = f;
  else if (/^posteriorpredictive$/i.test(kind)) groups[set].pp = f;
  else if (/^density_/i.test(kind)) groups[set].densities.push(f);
});

// Sorted set ids
const setIds = Object.keys(groups).sort((a,b)=>Number(a)-Number(b));

// ===== Render 3×3 grids for R0 / beta / PP =====
const gridR0   = document.getElementById('grid-r0');
const gridBeta = document.getElementById('grid-beta');
const gridPP   = document.getElementById('grid-pp');

setIds.forEach(set => { const f = groups[set].r0;   if (f) gridR0.appendChild(makePdfTile(f));   });
setIds.forEach(set => { const f = groups[set].beta; if (f) gridBeta.appendChild(makePdfTile(f)); });
setIds.forEach(set => { const f = groups[set].pp;   if (f) gridPP.appendChild(makePdfTile(f));   });

// ===== Render per-set 3×2 grids for Densities =====
const densRoot = document.getElementById('dens-sets');
setIds.forEach(set => {
  const densList = groups[set].densities.sort(); // alpha, E0, I0, phi_inv, S0, tau …
  if (!densList.length) return;

  const block = document.createElement('section');
  block.style.margin = '18px 0 28px';

  const h = document.createElement('h3');
  h.textContent = `Set ${set}`;
  h.style.margin = '12px 0';
  h.style.fontSize = '18px';
  block.appendChild(h);

  const grid = document.createElement('div');
  grid.className = 'grid grid-3x2';
  densList.forEach(f => grid.appendChild(makePdfTile(f)));
  block.appendChild(grid);

  densRoot.appendChild(block);
});

// ===== Global filter & count =====
const search = document.getElementById('search');
const count  = document.getElementById('count');
const allTiles = Array.from(document.querySelectorAll('.tile'));

function applyFilter(q) {
  const needle = (q || '').trim().toLowerCase();
  let visible = 0;
  allTiles.forEach(t => {
    const hay = (t.dataset.caption + ' ' + (t.getAttribute('href')||'')).toLowerCase();
    const show = !needle || hay.includes(needle);
    t.classList.toggle('hide', !show);
    if (show) visible++;
  });
  if (count) count.textContent = visible;
}
search?.addEventListener('input', (e)=>applyFilter(e.target.value));
applyFilter('');
</script>

